<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><title>Test::StagedFileProducer</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="stylesheet" title="blkbluw" type="text/css" href="../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="blkbluw" type="text/css" href="../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="whtpurk" type="text/css" href="../_whtpurk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../_grygrnw.css" media="all" >

<script type="text/javascript" src="../_podly.js"></script>

</head>
<body class='pod'>

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#SYNOPSIS'>SYNOPSIS</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <li class='indexItem indexItem1'><a href='#FUNCTIONS'>FUNCTIONS</a>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>Test::StagedFileProducer -- mtime-based file production engine</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>

<pre>  use Test::StagedFileProducer;

  my $wherever = &#39;/your/test/directory&#39;;

  my $producer = Test::StagedFileProducer-&#62;new(path =&#62; $wherever);
  $producer-&#62;exclude(&#34;$wherever/log&#34;, &#34;$wherever/build-stamp&#34;);

  my $output = &#34;$wherever/file.out&#34;;
  $producer-&#62;add_stage(
        products =&#62; [$output],
        build =&#62;sub {
            printf &#34;Building $output.\n&#34;;
        },
        skip =&#62;sub {
            printf &#34;Skipping $output.\n&#34;;
        }
  );

  $producer-&#62;run(minimum_epoch =&#62; time, verbose =&#62; 1);</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p>Provides a way to define and stack file production stages that all depend on subsets of the same group of files.</p>

<p>After the stages are defined, the processing engine takes an inventory of all files in a target directory. It excludes some files, like logs, that should not be considered.</p>

<p>Each stage adds its own products to the list of files to be excluded before deciding whether to produce them. The decision is based on relative file modification times, in addition to a systemic rebuilding threshold. Before rebuilding, each stage asks a lower stage to make the same determination.</p>

<p>The result is an engine with file production stages that depend on successively larger sets of files.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="FUNCTIONS"
>FUNCTIONS</a></h1>

<dl>
<dt><a name="new(path_=&#62;_PATH)"
>new(path =&#62; PATH)</a></dt>

<dd>
<p>Create a new instance focused on files in directory PATH.</p>

<dt><a name="exclude(LIST)"
>exclude(LIST)</a></dt>

<dd>
<p>Excludes all absolute paths in LIST from all mtime comparisons. This is especially useful for logs. Calls to Path::Tiny-&#62;realpath are made to ensure the elements are canonical and have a chance of matching something returned by File::Find::Rule.</p>

<dt><a name="add_stage(HASH)"
>add_stage(HASH)</a></dt>

<dd>
<p>Add a stage defined by HASH to the processing engine for processing after stages previously added. HASH can define the following keys:</p>

<p>$HASH{products} =&#62; LIST; a list of full-path filenames to be produced.</p>

<p>$HASH{minimum_epoch} =&#62; EPOCH; an integer threshold for maximum age</p>

<p>$HASH{build} =&#62; SUB; a sub executed when production is required.</p>

<p>$HASH{skip} =&#62; SUB; a sub executed when production is not required.</p>

<dt><a name="run(PARAMETERS)"
>run(PARAMETERS)</a></dt>

<dd>
<p>Runs the defined engine using the given parameters, which are arranged in a matching list suitable for assignment to a hash. The following two parameters are currently available:</p>

<p>minimum_epoch =&#62; EPOCH; a systemic threshold, in epochs, below which rebuilding is mandatory for any product.</p>

<p>verbose =&#62; BOOLEAN; an option to enable more verbose reporting</p>

<dt><a name="_process_remaining_stages(LIST)"
>_process_remaining_stages(LIST)</a></dt>

<dd>
<p>An internal subroutine that is used recursively to execute the stages. The list passed describes the list of files to be excluded from subsequent mtime calculations.</p>

<p>Please note that the bulk of the execution takes place after calling the next lower stage. That is to ensure that any lower build targets (or products, in our parlance) are met before the present stage attempts to do its job.</p>
</dd>
</dl>
<p class="backlinkbottom"><b><a name="___bottom" href="../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
